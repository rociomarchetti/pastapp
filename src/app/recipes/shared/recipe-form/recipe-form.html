<div class="recipe-form">
  <form [formGroup]="recipeForm">
    <section class="recipe-form__header">
      <div class="recipe-form__img">
        <label
          class="recipe-form__img-box"
          [style.background-image]="recipeBg()"
        >
          <div class="recipe-form__img-overlay">
            <span>{{ imgActionMsg }}</span>
            <input
              id="img"
              type="file"
              accept="image/*"
              (change)="onImageFileSelected($event)"
              hidden
            />
            <input
              type="text"
              placeholder="O pega una URL de imagen"
              (input)="onImageUrlChange($event)"
            />
          </div>
        </label>
      </div>
      <div class="recipe-form__summary">
        <div>
          <h3>Nombre de la receta:</h3>
          <fieldset class="recipe-form__fieldset-name">
            <input
              aria-expanded="true"
              placeholder="Ejemplo: Ravioles"
              class="name-input"
              formControlName="name"
            />
          </fieldset>
        </div>
        @if(recipeForm.get('name')?.touched && recipeForm.get('name')?.invalid){
        <div class="recipe-form__error-msg">
          El nombre es obligatorio. Mínimo 3 caracteres.
        </div>
        }
        <div class="recipe-form__fieldset-data">
          <div>
            <h3>Minutos de preparación:</h3>
            <fieldset>
              <input
                matInput
                aria-expanded="true"
                placeholder="Ejemplo: 40"
                class="prepTime-input"
                formControlName="prepTime"
              />
            </fieldset>
          </div>
          <mat-divider [vertical]="true"></mat-divider>
          <div>
            <h3>Cantidad de porciones:</h3>
            <fieldset>
              <input
                matInput
                aria-expanded="true"
                placeholder="Ejemplo: 4"
                class="servings-input"
                formControlName="servings"
              />
            </fieldset>
          </div>
          <mat-divider [vertical]="true"></mat-divider>
          <div>
            <h3>Nivel de dificultad:</h3>
            <mat-form-field>
              <mat-label>Dificultad</mat-label>
              <mat-select formControlName="difficulty">
                <mat-option [value]="DifficultyLevel.LOW">Fácil</mat-option>
                <mat-option [value]="DifficultyLevel.MEDIUM">Media</mat-option>
                <mat-option [value]="DifficultyLevel.HIGH">Alta</mat-option>
              </mat-select>
            </mat-form-field>
          </div>
        </div>
        @if(recipeForm.get('prepTime')?.touched &&
        recipeForm.get('prepTime')?.invalid){
        <div class="recipe-form__error-msg">
          Debes ingresar el tiempo de preparación.
        </div>
        } @if(recipeForm.get('servings')?.touched &&
        recipeForm.get('servings')?.invalid){
        <div class="recipe-form__error-msg">
          Debes ingresar la cantidad de porciones.
        </div>
        } @if(recipeForm.get('difficulty')?.touched &&
        recipeForm.get('difficulty')?.invalid){
        <div class="recipe-form__error-msg">
          Debes ingresar un nivel de dificultad.
        </div>
        }
      </div>
    </section>
    <section class="recipe-form__body">
      <div class="recipe-form__ingredients">
        <h3>Ingredientes:</h3>
        <div formArrayName="ingredients">
          @for(item of ingredients.controls; track $index; let i = $index){
          <div [formGroupName]="i" class="recipe-form__ingredient">
            <mat-form-field class="recipe-form__ingredient-name-input">
              <mat-label>Ingrediente {{ i + 1 }}</mat-label>
              <input matInput formControlName="name" />
            </mat-form-field>

            <mat-form-field class="recipe-form__ingredient-quantity-input">
              <mat-label>Cantidad</mat-label>
              <input matInput formControlName="quantity" />
            </mat-form-field>

            <button
              mat-icon-button
              color="warn"
              (click)="onRemoveIngredient(i)"
            >
              <mat-icon>delete</mat-icon>
            </button>
          </div>
          }
        </div>
        @if(recipeForm.get('ingredients')?.touched
        &&recipeForm.get('ingredients')?.invalid){
        <div class="recipe-form__error-msg">
          Debes ingresar el nombre de al menos un ingrediente.
        </div>
        }
        <app-button
          [label]="'+ Ingrediente'"
          (clickOutput)="onAddIngredient()"
        ></app-button>
      </div>
      <div class="recipe-form__instructions">
        <h3>Pasos a seguir:</h3>
        <div formArrayName="instructions">
          @for(item of instructions.controls; track $index; let i = $index){
          <div class="recipe-form__instruction">
            <mat-form-field>
              <mat-label>Paso {{ i + 1 }}</mat-label>
              <input matInput [formControlName]="i" />
            </mat-form-field>
            <button
              mat-icon-button
              color="warn"
              (click)="onRemoveInstruction(i)"
            >
              <mat-icon>delete</mat-icon>
            </button>
          </div>
          }
        </div>
        @if(recipeForm.get('instructions')?.touched &&
        recipeForm.get('instructions')?.invalid){
        <div class="recipe-form__error-msg">
          Debes ingresar al menos un paso a seguir.
        </div>
        }
        <app-button
          [label]="'+ Instrucción'"
          (clickOutput)="onAddInstruction()"
        ></app-button>
      </div>
    </section>
    <div class="recipe-form__submit">
      <button (click)="onSaveRecipe()">
        <h2>Guardar receta</h2>
      </button>
    </div>
  </form>
</div>
